# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile_fixed                                     :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: wsm <wsm@student.42.fr>                    +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2024/08/11 11:50:00 by wsm               #+#    #+#              #
#    Updated: 2024/08/11 11:50:00 by wsm              ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

NAME := pipex_fixed

LIBFT_DIR := ../libft_full
LIBFT_LIB := $(LIBFT_DIR)/libft_full.a

SRC_DIR := .
SRC_FILES := pipex_bonus_fixed.c \
			 utils_bonus_fixed.c

INCLUDE_DIR := ../include

COMPILE_FLAGS := -Wall -Wextra -Werror -I$(INCLUDE_DIR)

OBJ := $(SRC_FILES:%.c=$(SRC_DIR)/%.o)
HEADERS := $(INCLUDE_DIR)/pipex.h

all: $(NAME)

$(LIBFT_LIB):
	@make -C $(LIBFT_DIR) -s --no-print-directory

%.o: %.c
	cc $(COMPILE_FLAGS) -c $< -o $@

$(NAME): $(LIBFT_LIB) $(OBJ) $(HEADERS)
	cc $(COMPILE_FLAGS) $(OBJ) $(LIBFT_LIB) -o $(NAME)

clean:
	@make -C $(LIBFT_DIR) $@ --no-print-directory
	@rm -f $(OBJ)

fclean: clean
	@make -C $(LIBFT_DIR) $@ --no-print-directory
	rm -f $(NAME)

re: fclean all

test: $(NAME)
	@echo "ðŸ§ª Testing fixed version..."
	@echo "Creating test files..."
	@echo -e "line1\ntest line\nline3" > test_input.txt
	@echo -e "3\n1\n2" > test_numbers.txt
	
	@echo "Test 1: Basic pipeline"
	./$(NAME) test_input.txt "grep test" "wc -l" output1.txt
	@echo "Result: $$(cat output1.txt)"
	
	@echo "Test 2: Multi-command pipeline"
	./$(NAME) test_numbers.txt "sort -n" "head -2" "wc -l" output2.txt
	@echo "Result: $$(cat output2.txt)"
	
	@echo "Test 3: Heredoc (manual - type 'END' to finish)"
	@echo -e "hello\nworld\nEND" | ./$(NAME) here_doc END "tr a-z A-Z" "wc -w" output3.txt
	@echo "Result: $$(cat output3.txt)"
	
	@echo "âœ… All tests completed!"

.PHONY: all clean fclean re test
